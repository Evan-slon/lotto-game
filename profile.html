<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Lottery - Личный кабинет</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0088cc;
            --primary-dark: #006699;
            --secondary: #ff6b35;
            --background: #0f1b2b;
            --surface: #1a2b3e;
            --text: #ffffff;
            --text-secondary: #a0b3c6;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #f44336;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            padding-bottom: 80px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 0;
        }

        .header h1 {
            font-size: 1.5rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        /* Навигация */
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            padding: 10px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item i {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        /* Верхняя строка профиля */
        .profile-header {
            background: var(--surface);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .user-details h3 {
            font-size: 1.1rem;
            margin-bottom: 2px;
        }

        .user-details p {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .stats-row {
            display: flex;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.7rem;
        }

        /* Пагинация разделов */
        .section-nav {
            display: flex;
            background: var(--surface);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            gap: 5px;
        }

        .section-btn {
            flex: 1;
            padding: 12px 5px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .section-btn.active {
            background: var(--primary);
            color: white;
        }

        .section-btn:hover:not(.active) {
            background: rgba(255,255,255,0.1);
        }

        /* Разделы контента */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Раздел Кошелек */
        .wallet-card {
            background: var(--surface);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 15px;
            text-align: center;
        }

        .wallet-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .wallet-balance {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .wallet-address {
            background: var(--background);
            padding: 10px 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 0.8rem;
            word-break: break-all;
        }

        .wallet-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-wallet {
            background: linear-gradient(45deg, #0088cc, #0095ff);
            color: white;
            width: 100%;
            margin-top: 15px;
        }

        .btn:hover {
            transform: scale(1.02);
        }

        .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.4);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .btn-wallet:hover {
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.4);
        }

        /* Раздел Статистика */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-card .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .stat-card .stat-value {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            font-size: 0.8rem;
        }

        /* Мои билеты */
        .my-tickets-section {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .tickets-pool {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tickets-pool:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .pool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .pool-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
        }

        .ticket-count {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .tickets-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .my-ticket {
            background: var(--background);
            border: 2px solid var(--primary);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .transactions-list {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .icon-buy {
            background: rgba(0, 136, 204, 0.2);
            color: var(--primary);
        }

        .icon-win {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }

        .icon-deposit {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }

        .icon-withdraw {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error);
        }

        .transaction-details h4 {
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .transaction-details p {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .amount-positive {
            color: var(--success);
        }

        .amount-negative {
            color: var(--error);
        }

        /* Раздел Рейтинг */
        .rating-list {
            background: var(--surface);
            border-radius: 15px;
            padding: 20px;
        }

        .rating-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .rating-item:last-child {
            border-bottom: none;
        }

        .rating-position {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 0.9rem;
        }

        .position-1 {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
        }

        .position-2 {
            background: linear-gradient(45deg, #C0C0C0, #A0A0A0);
            color: #000;
        }

        .position-3 {
            background: linear-gradient(45deg, #CD7F32, #A0522D);
            color: #000;
        }

        .rating-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .rating-info {
            flex: 1;
        }

        .rating-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .rating-stats {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .rating-amount {
            font-weight: bold;
            color: var(--secondary);
        }

        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            max-width: 350px;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.1);
            background: var(--background);
            border-radius: 10px;
            color: var(--text);
            font-size: 1rem;
        }

        .input-group input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Пустое состояние */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Адаптивность */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .profile-header {
                padding: 12px;
            }
            
            .user-avatar {
                width: 45px;
                height: 45px;
            }
            
            .stats-row {
                gap: 10px;
            }
            
            .stat-value {
                font-size: 1.1rem;
            }
            
            .tickets-list {
                gap: 6px;
            }
            
            .my-ticket {
                padding: 4px 10px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Шапка -->
        <div class="header">
            <h1>🎰 TON Lottery</h1>
            <p>Личный кабинет</p>
        </div>

        <!-- Личный кабинет -->
        <div id="profilePage">
            <!-- Верхняя строка профиля -->
            <div class="profile-header">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">👤</div>
                    <div class="user-details">
                        <h3 id="userName">Гость</h3>
                        <p>ID: <span id="userId">123456</span></p>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">Игры</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="walletBalance">0</div>
                        <div class="stat-label">TON</div>
                    </div>
                </div>
            </div>

            <!-- Пагинация разделов -->
            <div class="section-nav">
                <button class="section-btn active" onclick="showSection('wallet')">👛 Кошелек</button>
                <button class="section-btn" onclick="showSection('stats')">📊 Статистика</button>
                <button class="section-btn" onclick="showSection('tickets')">🎫 Мои билеты</button>
                <button class="section-btn" onclick="showSection('rating')">🏆 Рейтинг</button>
            </div>

            <!-- Раздел Кошелек -->
            <div id="walletSection" class="content-section active">
                <div class="wallet-card">
                    <div class="wallet-icon">👛</div>
                    <div class="wallet-balance" id="walletBalanceBig">0 TON</div>
                    <div>Баланс кошелька</div>
                    
                    <!-- Кнопка привязки кошелька теперь всегда видна -->
                    <button class="btn btn-wallet" onclick="connectWallet()">🔗 Привязать TON Wallet</button>
                    
                    <div id="walletConnected" style="display: none;">
                        <div class="wallet-address" id="walletAddress">
                            Кошелек не подключен
                        </div>
                        <!-- Кнопки вывода и внесения TON расположены ниже -->
                        <div class="wallet-actions">
                            <button class="btn btn-primary" onclick="showDepositModal()">Внести TON</button>
                            <button class="btn btn-secondary" onclick="showWithdrawModal()">Вывести TON</button>
                        </div>
                    </div>
                    
                    <div id="walletDisconnected" style="display: none;">
                        <p style="color: var(--text-secondary); margin: 20px 0; font-size: 0.9rem;">
                            Подключите TON кошелек для управления средствами
                        </p>
                    </div>
                </div>
            </div>

            <!-- Раздел Статистика -->
            <div id="statsSection" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">🎮</div>
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">Сыграно игр</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">💸</div>
                        <div class="stat-value" id="totalSpent">0</div>
                        <div class="stat-label">Потрачено</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🏆</div>
                        <div class="stat-value" id="totalWon">0</div>
                        <div class="stat-label">Выиграно</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🎫</div>
                        <div class="stat-value" id="totalTickets">0</div>
                        <div class="stat-label">Билетов</div>
                    </div>
                </div>

                <div class="transactions-list">
                    <div class="section-title">История операций</div>
                    <div id="transactionsList">
                        <!-- Транзакции будут загружены через JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Раздел Мои билеты -->
            <div id="ticketsSection" class="content-section">
                <div class="my-tickets-section">
                    <div class="section-title">🎫 Мои билеты</div>
                    <div id="myTicketsList">
                        <!-- Билеты будут загружены через JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Раздел Рейтинг -->
            <div id="ratingSection" class="content-section">
                <div class="rating-list">
                    <div class="section-title">Топ игроков</div>
                    <div id="ratingList">
                        <!-- Рейтинг будет загружен через JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно внесения средств -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h3>Внести TON</h3>
            <div class="input-group">
                <label>Сумма для пополнения (TON)</label>
                <input type="number" id="depositAmount" placeholder="0.0" min="0.1" step="0.1">
            </div>
            <div style="background: var(--background); padding: 15px; border-radius: 10px; margin: 15px 0;">
                <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 5px;">Адрес для пополнения:</div>
                <div id="depositAddress" style="font-family: monospace; font-size: 0.8rem; word-break: break-all;"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideDepositModal()" style="flex: 1;">Отмена</button>
                <button class="btn btn-primary" onclick="confirmDeposit()" style="flex: 1;">Скопировать адрес</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно вывода средств -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h3>Вывести TON</h3>
            <div class="input-group">
                <label>Сумма для вывода (TON)</label>
                <input type="number" id="withdrawAmount" placeholder="0.0" min="0.1" step="0.1">
            </div>
            <div class="input-group">
                <label>Адрес кошелька</label>
                <input type="text" id="withdrawAddress" placeholder="Введите адрес TON кошелька">
            </div>
            <div style="color: var(--text-secondary); font-size: 0.8rem; margin: 10px 0;">
                Доступно для вывода: <span id="availableBalance" style="color: var(--secondary); font-weight: bold;">0 TON</span>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideWithdrawModal()" style="flex: 1;">Отмена</button>
                <button class="btn btn-primary" onclick="confirmWithdraw()" style="flex: 1;">Вывести</button>
            </div>
        </div>
    </div>

    <!-- Навигация -->
    <div class="navigation">
        <a href="index.html" class="nav-item">
            <i>🎰</i>
            Главная
        </a>
        <a href="tickets.html" class="nav-item">
            <i>🎫</i>
            Билеты
        </a>
        <a href="profile.html" class="nav-item active">
            <i>👤</i>
            Кабинет
        </a>
        <a href="rules.html" class="nav-item">
            <i>📖</i>
            Правила
        </a>
        <a href="roadmap.html" class="nav-item">
            <i>🗺️</i>
            Карта
        </a>
    </div>

    <script>
        // Данные пользователя
        const userData = {
            profile: {
                name: "Гость",
                userId: "123456",
                walletBalance: 0,
                gamesPlayed: 0,
                totalSpent: 0,
                totalWon: 0,
                ticketsBought: 0,
                walletConnected: false,
                walletAddress: ""
            },
            transactions: [],
            topPlayers: [],
            myTickets: {}
        };

        // Инициализация личного кабинета
        function initProfilePage() {
            loadUserData();
            updateProfileHeader();
            loadTransactions();
            loadMyTickets();
            loadTopPlayers();
        }

        // Загрузка данных пользователя
        function loadUserData() {
            const saved = localStorage.getItem('tonLotteryGameData');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.userProfile) {
                    userData.profile = { ...userData.profile, ...data.userProfile };
                }
                // Загружаем транзакции из покупок
                if (data.pools) {
                    loadPurchaseTransactions(data.pools);
                }
                // Загружаем билеты пользователя
                if (data.userTickets) {
                    userData.myTickets = data.userTickets;
                }
            }
        }

        // Загрузка билетов пользователя
        function loadMyTickets() {
            const saved = localStorage.getItem('tonLotteryGameData');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.pools) {
                    // Собираем все билеты пользователя из всех пулов
                    userData.myTickets = {};
                    
                    for (const [poolPrice, pool] of Object.entries(data.pools)) {
                        if (pool.soldTicketsList && pool.soldTicketsList.length > 0) {
                            // В реальном приложении здесь была бы проверка принадлежности билетов пользователю
                            // Для демо считаем, что все проданные билеты принадлежат текущему пользователю
                            userData.myTickets[poolPrice] = {
                                poolName: pool.name,
                                tickets: [...pool.soldTicketsList].sort((a, b) => a - b)
                            };
                        }
                    }
                }
            }
        }

        // Загрузка транзакций покупок
        function loadPurchaseTransactions(pools) {
            // Добавляем транзакции покупок из всех пулов
            for (const [poolPrice, pool] of Object.entries(pools)) {
                if (pool.soldTickets > 0) {
                    userData.transactions.unshift({
                        type: 'buy',
                        amount: -pool.soldTickets * pool.price,
                        description: `Покупка ${pool.soldTickets} билетов (${pool.name})`,
                        date: new Date().toLocaleString('ru-RU'),
                        tickets: Array.from({length: pool.soldTickets}, (_, i) => i + 1)
                    });
                }
            }
        }

        // Сохранение данных пользователя
        function saveUserData() {
            const saved = localStorage.getItem('tonLotteryGameData');
            let data = saved ? JSON.parse(saved) : {};
            data.userProfile = userData.profile;
            data.userTickets = userData.myTickets;
            localStorage.setItem('tonLotteryGameData', JSON.stringify(data));
        }

        // Обновление верхней строки профиля
        function updateProfileHeader() {
            document.getElementById('userName').textContent = userData.profile.name;
            document.getElementById('userId').textContent = userData.profile.userId;
            document.getElementById('gamesPlayed').textContent = userData.profile.gamesPlayed;
            document.getElementById('walletBalance').textContent = userData.profile.walletBalance;
            document.getElementById('walletBalanceBig').textContent = userData.profile.walletBalance + ' TON';

            // Обновляем информацию о кошельке
            const walletConnected = document.getElementById('walletConnected');
            const walletDisconnected = document.getElementById('walletDisconnected');
            const walletAddress = document.getElementById('walletAddress');
            
            if (userData.profile.walletConnected) {
                walletConnected.style.display = 'block';
                walletDisconnected.style.display = 'none';
                walletAddress.textContent = userData.profile.walletAddress;
            } else {
                walletConnected.style.display = 'none';
                walletDisconnected.style.display = 'block';
            }

            // Обновляем статистику
            updateStatsSection();
        }

        // Обновление раздела статистики
        function updateStatsSection() {
            document.getElementById('totalGames').textContent = userData.profile.gamesPlayed;
            document.getElementById('totalSpent').textContent = userData.profile.totalSpent;
            document.getElementById('totalWon').textContent = userData.profile.totalWon;
            document.getElementById('totalTickets').textContent = userData.profile.ticketsBought;
        }

        // Обновление раздела "Мои билеты"
        function updateMyTicketsSection() {
            const myTicketsList = document.getElementById('myTicketsList');
            myTicketsList.innerHTML = '';

            if (Object.keys(userData.myTickets).length === 0) {
                myTicketsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🎫</div>
                        <div>У вас пока нет купленных билетов</div>
                        <div style="margin-top: 10px; font-size: 0.9rem;">Приобретите билеты в разделе "Билеты"</div>
                    </div>
                `;
                return;
            }

            for (const [poolPrice, poolData] of Object.entries(userData.myTickets)) {
                const poolElement = document.createElement('div');
                poolElement.className = 'tickets-pool';
                
                poolElement.innerHTML = `
                    <div class="pool-header">
                        <div class="pool-title">${poolData.poolName}</div>
                        <div class="ticket-count">${poolData.tickets.length} шт.</div>
                    </div>
                    <div class="tickets-list" id="ticketsPool${poolPrice}">
                        <!-- Билеты этого пула -->
                    </div>
                `;
                
                myTicketsList.appendChild(poolElement);

                // Заполняем билеты для этого пула
                const ticketsContainer = document.getElementById(`ticketsPool${poolPrice}`);
                poolData.tickets.forEach(ticketNumber => {
                    const ticketElement = document.createElement('div');
                    ticketElement.className = 'my-ticket';
                    ticketElement.textContent = `#${ticketNumber}`;
                    ticketsContainer.appendChild(ticketElement);
                });
            }
        }

        // Подключение кошелька
        function connectWallet() {
            if (userData.profile.walletConnected) {
                alert('Кошелек уже подключен!');
                return;
            }

            // Симуляция подключения кошелька
            const walletAddress = 'EQ' + Math.random().toString(36).substr(2, 20).toUpperCase();
            
            userData.profile.walletConnected = true;
            userData.profile.walletAddress = walletAddress;
            userData.profile.name = 'Игрок #' + Math.floor(Math.random() * 10000);
            userData.profile.walletBalance = 50; // Начальный баланс
            
            // Добавляем транзакцию пополнения
            userData.transactions.unshift({
                type: 'deposit',
                amount: 50,
                description: 'Пополнение счета',
                date: new Date().toLocaleString('ru-RU')
            });
            
            saveUserData();
            updateProfileHeader();
            loadTransactions();
            
            alert('TON кошелек успешно подключен!');
        }

        // Переключение разделов
        function showSection(sectionName) {
            // Обновляем кнопки
            document.querySelectorAll('.section-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Показываем выбранный раздел
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName + 'Section').classList.add('active');

            // Если перешли в раздел "Мои билеты", обновляем его
            if (sectionName === 'tickets') {
                loadMyTickets();
                updateMyTicketsSection();
            }
        }

        // Показать модальное окно внесения средств
        function showDepositModal() {
            if (!userData.profile.walletConnected) {
                alert('Сначала подключите TON кошелек!');
                return;
            }
            document.getElementById('depositModal').classList.add('active');
            document.getElementById('depositAddress').textContent = userData.profile.walletAddress;
        }

        // Скрыть модальное окно внесения средств
        function hideDepositModal() {
            document.getElementById('depositModal').classList.remove('active');
        }

        // Показать модальное окно вывода средств
        function showWithdrawModal() {
            if (!userData.profile.walletConnected) {
                alert('Сначала подключите TON кошелек!');
                return;
            }
            document.getElementById('withdrawModal').classList.add('active');
            document.getElementById('availableBalance').textContent = userData.profile.walletBalance + ' TON';
            document.getElementById('withdrawAmount').max = userData.profile.walletBalance;
        }

        // Скрыть модальное окно вывода средств
        function hideWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('active');
        }

        // Подтверждение внесения средств
        function confirmDeposit() {
            const depositAddress = userData.profile.walletAddress;
            navigator.clipboard.writeText(depositAddress).then(() => {
                alert('Адрес для пополнения скопирован в буфер обмена!');
                hideDepositModal();
            });
        }

        // Подтверждение вывода средств
        function confirmWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const address = document.getElementById('withdrawAddress').value.trim();

            if (!amount || amount <= 0) {
                alert('Введите корректную сумму для вывода');
                return;
            }

            if (amount > userData.profile.walletBalance) {
                alert('Недостаточно средств на балансе');
                return;
            }

            if (!address || address.length < 10) {
                alert('Введите корректный адрес TON кошелька');
                return;
            }

            // Симуляция вывода
            userData.profile.walletBalance -= amount;
            
            // Добавляем транзакцию
            userData.transactions.unshift({
                type: 'withdraw',
                amount: -amount,
                description: 'Вывод средств',
                date: new Date().toLocaleString('ru-RU'),
                address: address
            });

            saveUserData();
            updateProfileHeader();
            loadTransactions();
            
            alert(`Запрос на вывод ${amount} TON отправлен!`);
            hideWithdrawModal();
        }

        // Загрузка истории транзакций
        function loadTransactions() {
            const transactionsList = document.getElementById('transactionsList');
            
            if (userData.transactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <div>Операций пока нет</div>
                    </div>
                `;
                return;
            }

            transactionsList.innerHTML = '';
            userData.transactions.forEach(transaction => {
                const transactionItem = document.createElement('div');
                transactionItem.className = 'transaction-item';
                
                let iconClass, iconSymbol;
                switch(transaction.type) {
                    case 'buy': iconClass = 'icon-buy'; iconSymbol = '🎫'; break;
                    case 'win': iconClass = 'icon-win'; iconSymbol = '🏆'; break;
                    case 'deposit': iconClass = 'icon-deposit'; iconSymbol = '⬇️'; break;
                    case 'withdraw': iconClass = 'icon-withdraw'; iconSymbol = '⬆️'; break;
                }
                
                const amountClass = transaction.amount > 0 ? 'amount-positive' : 'amount-negative';
                const amountSign = transaction.amount > 0 ? '+' : '';
                
                transactionItem.innerHTML = `
                    <div class="transaction-info">
                        <div class="transaction-icon ${iconClass}">${iconSymbol}</div>
                        <div class="transaction-details">
                            <h4>${transaction.description}</h4>
                            <p>${transaction.date}</p>
                        </div>
                    </div>
                    <div class="transaction-amount ${amountClass}">
                        ${amountSign}${transaction.amount} TON
                    </div>
                `;
                
                transactionsList.appendChild(transactionItem);
            });
        }

        // Загрузка топа игроков
        function loadTopPlayers() {
            const ratingList = document.getElementById('ratingList');
            
            // Генерируем демо-рейтинг
            userData.topPlayers = [
                { name: 'КриптоWolf', amount: 12500, games: 45 },
                { name: 'TON_Investor', amount: 9800, games: 32 },
                { name: 'Lucky777', amount: 7450, games: 28 },
                { name: 'BlockchainPro', amount: 6200, games: 25 },
                { name: 'CryptoQueen', amount: 5800, games: 22 },
                { name: 'DigitalNomad', amount: 4200, games: 18 },
                { name: 'SmartContract', amount: 3800, games: 15 }
            ];

            if (userData.topPlayers.length === 0) {
                ratingList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🏆</div>
                        <div>Рейтинг пока пуст</div>
                    </div>
                `;
                return;
            }

            ratingList.innerHTML = '';
            userData.topPlayers.forEach((player, index) => {
                const ratingItem = document.createElement('div');
                ratingItem.className = 'rating-item';
                
                const positionClass = index < 3 ? `position-${index + 1}` : '';
                const avatarLetter = player.name.charAt(0);
                
                ratingItem.innerHTML = `
                    <div class="rating-position ${positionClass}">${index + 1}</div>
                    <div class="rating-avatar">${avatarLetter}</div>
                    <div class="rating-info">
                        <div class="rating-name">${player.name}</div>
                        <div class="rating-stats">${player.games} игр</div>
                    </div>
                    <div class="rating-amount">${player.amount} TON</div>
                `;
                
                ratingList.appendChild(ratingItem);
            });
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', initProfilePage);
    </script>
</body>
</html>
